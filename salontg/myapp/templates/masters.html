{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title|default:"–ù–∞—à–∏ –º–∞—Å—Ç–µ—Ä–∞ - –°–∞–ª–æ–Ω –∫—Ä–∞—Å–æ—Ç—ã TanGel" }}{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/masters.css' %}">
{% endblock %}

{% block content %}
<div class="masters-hero">
    <h1>{{ hero_title|default:"–ù–∞—à–∏ –º–∞—Å—Ç–µ—Ä–∞" }}</h1>
    <p>{{ hero_subtitle|default:"–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—ã —Å –ª—é–±–æ–≤—å—é –∫ —Å–≤–æ–µ–º—É –¥–µ–ª—É –∏ –≤–Ω–∏–º–∞–Ω–∏–µ–º –∫ –∫–∞–∂–¥–æ–º—É –∫–ª–∏–µ–Ω—Ç—É" }}</p>
</div>

<!-- –§–∏–ª—å—Ç—Ä—ã -->
<div class="filters-section">
    <div class="filters-row">
        <div class="filter-group">
            <label for="specialization">–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è</label>
            <select id="specialization" class="filter-control">
                <option value="">–í—Å–µ –º–∞—Å—Ç–µ—Ä–∞</option>
                {% for specialization in specializations %}
                    <option value="{{ specialization.id }}">{{ specialization.name }}</option>
                {% endfor %}
            </select>
        </div>
        {% if popular_masters %}
        <div class="filter-group">
            <label for="popular">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</label>
            <select id="popular" class="filter-control">
                <option value="">–í—Å–µ</option>
                <option value="true">–¢–æ–ª—å–∫–æ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ</option>
            </select>
        </div>
        {% endif %}
        <div class="filter-actions">
            <button class="btn-filter btn-apply">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            <button class="btn-filter btn-reset">–°–±—Ä–æ—Å–∏—Ç—å</button>
        </div>
    </div>
</div>

<!-- –°–ø–∏—Å–æ–∫ –º–∞—Å—Ç–µ—Ä–æ–≤ -->
<div class="masters-grid">
    {% for master in page_obj %}
    <div class="master-card">
        <div class="master-avatar">
            {% if master.photo %}
                <img src="{{ master.photo.url }}" alt="{{ master.name }}">
            {% else %}
                <div class="avatar-placeholder">üë§</div>
            {% endif %}
            <div class="badges">
                {% if master.is_popular %}
                    <span class="badge popular">–ü–æ–ø—É–ª—è—Ä–Ω—ã–π</span>
                {% endif %}
                {% if master.is_new %}
                    <span class="badge new">–ù–æ–≤—ã–π</span>
                {% endif %}
            </div>
        </div>

        <div class="master-info">
            <h3>{{ master.name }}</h3>
            <p class="specializations">
                {% for spec in master.specializations.all %}
                    {{ spec.name }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
            </p>
            <p class="experience">–û–ø—ã—Ç: {{ master.experience }} {{ master.experience|pluralize:"–≥–æ–¥,–≥–æ–¥–∞,–ª–µ—Ç" }}</p>

            <div class="rating">
                {% with rating=master.average_rating|default:0 %}
                    {% for i in "12345"|make_list %}
                        {% if forloop.counter <= rating|floatformat:0 %}
                            <span class="star">‚òÖ</span>
                        {% elif forloop.counter|add:"-0.5" <= rating %}
                            <span class="star">‚òÖ¬Ω</span>
                        {% else %}
                            <span class="star">‚òÜ</span>
                        {% endif %}
                    {% endfor %}
                {% endwith %}
                <span>{{ master.average_rating|floatformat:1 }} ({{ master.review_count|default:0 }} –æ—Ç–∑—ã–≤{{ master.review_count|default:0|pluralize:"–æ–≤,–∞" }})</span>
            </div>

            {% if master.description %}
            <p class="description">{{ master.description|truncatechars:200 }}</p>
            {% endif %}

            {% if master.skills_as_list %}
            <div class="skills">
                {% for skill in master.skills_as_list|slice:":4" %}
                    <span class="skill-tag">{{ skill }}</span>
                {% endfor %}
                {% if master.skills_as_list|length > 4 %}
                    <span class="skill-tag">+{{ master.skills_as_list|length|add:"-4" }}</span>
                {% endif %}
            </div>
            {% endif %}

            <div class="price-info">
                {% if master.min_price and master.max_price %}
                    {{ master.min_price|floatformat:0 }} ‚Äì {{ master.max_price|floatformat:0 }} ‚ÇΩ
                {% else %}
                    {{ master.price|default:"2000" }} ‚ÇΩ / —á–∞—Å
                {% endif %}
                {% if master.free_consultation %}
                    <small>–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ</small>
                {% endif %}
            </div>

            <div class="master-actions">
                <a href="{% url 'booking' %}?master={{ master.id }}" class="btn">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</a>
                {% if user.is_staff %}
                    <a href="/admin/myapp/master/{{ master.id }}/change/" class="btn-outline">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                {% endif %}
            </div>

            <div class="certificates">
                {{ master.certificates_count|default:"0" }} —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç{{ master.certificates_count|default:"0"|pluralize:"–∞,–æ–≤" }}
                {% if master.education %}
                    ¬∑ {{ master.education|truncatechars:30 }}
                {% endif %}
            </div>
        </div>
    </div>
    {% empty %}
    <div class="no-masters">
        <h3>–ú–∞—Å—Ç–µ—Ä–∞ –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</h3>
        <p>–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è –Ω–∞—à–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã</p>
    </div>
    {% endfor %}
</div>

<!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
{% if is_paginated %}
<nav class="pagination">
    {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}" class="pagination-link">‚Üê –ù–∞–∑–∞–¥</a>
    {% endif %}

    {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
            <span class="current">{{ num }}</span>
        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
            <a href="?page={{ num }}" class="pagination-link">{{ num }}</a>
        {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}" class="pagination-link">–í–ø–µ—Ä–µ–¥ ‚Üí</a>
    {% endif %}
</nav>
{% endif %}

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<section class="masters-stats">
    <h2>{{ stats_title|default:"–ù–∞—à–∏ –º–∞—Å—Ç–µ—Ä–∞ –≤ —Ü–∏—Ñ—Ä–∞—Ö" }}</h2>
    <div class="stats-cards">
        <div class="stat-card">
            <strong>{{ stats.masters_count|default:page_obj.paginator.count }}</strong>
            <span>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –º–∞—Å—Ç–µ—Ä–æ–≤</span>
        </div>
        <div class="stat-card">
            <strong>{{ stats.avg_experience|floatformat:1|default:"6" }}+</strong>
            <span>–õ–µ—Ç —Å—Ä–µ–¥–Ω–∏–π –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã</span>
        </div>
        <div class="stat-card">
            <strong>{{ stats.avg_rating|floatformat:1|default:"4.8" }}</strong>
            <span>–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –º–∞—Å—Ç–µ—Ä–æ–≤</span>
        </div>
        <div class="stat-card">
            <strong>{{ stats.certificates_total|default:"24" }}</strong>
            <span>–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –∏ –¥–∏–ø–ª–æ–º–æ–≤</span>
        </div>
    </div>
</section>

<!-- CTA -->
<section class="masters-cta">
    <h2>{{ cta_title|default:"–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–µ–≥–æ –º–∞—Å—Ç–µ—Ä–∞" }}</h2>
    <p>{{ cta_text|default:"–ó–∞–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –∫ –ª—é–±–æ–º—É —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É –∏ –ø–æ–ª—É—á–∏—Ç–µ 10% —Å–∫–∏–¥–∫—É –Ω–∞ –ø–µ—Ä–≤—É—é –ø—Ä–æ—Ü–µ–¥—É—Ä—É" }}</p>
    <a href="{% url 'booking' %}" class="btn">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é</a>
</section>
{% endblock %}