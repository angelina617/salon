{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title|default:"–£—Å–ª—É–≥–∏ - –°–∞–ª–æ–Ω –∫—Ä–∞—Å–æ—Ç—ã TanGel" }}{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'services.css' %}">
{% endblock %}

{% block content %}
<div class="services-hero">
    <h1>{{ hero_title|default:"–ù–∞—à–∏ —É—Å–ª—É–≥–∏" }}</h1>
    <p>{{ hero_subtitle|default:"–ü–æ–ª–Ω—ã–π —Å–ø–µ–∫—Ç—Ä beauty-—É—Å–ª—É–≥ –æ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–≤" }}</p>
</div>

<!-- –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º -->
<div class="category-filter">
    <a href="{% url 'services' %}" class="filter-btn {% if not selected_category %}active{% endif %}">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</a>
    {% for category in categories %}
        <a href="?category={{ category.code }}" class="filter-btn {% if selected_category == category.code %}active{% endif %}">
            {{ category.name }}
        </a>
    {% endfor %}
</div>

<!-- –ü–æ–∏—Å–∫ -->
<div class="search-box">
    <form method="get" action="{% url 'services' %}">
        <input type="text" name="search" placeholder="–ü–æ–∏—Å–∫ —É—Å–ª—É–≥..." value="{{ search_query }}">
        {% if search_query %}
            <a href="{% url 'services' %}" class="clear-search">‚úï</a>
        {% endif %}
        <button type="submit">–ù–∞–π—Ç–∏</button>
    </form>
</div>

<!-- –°–ø–∏—Å–æ–∫ —É—Å–ª—É–≥ -->
<div class="services-grid">
    {% for service in page_obj %}
    <div class="service-card" id="service-{{ service.id }}">
        <div class="service-header">
            <h3>{{ service.name }}</h3>
            <span class="service-category-badge">
                {% for code, name in service.CATEGORY_CHOICES %}
                    {% if code == service.category %}
                        {{ name }}
                    {% endif %}
                {% endfor %}
            </span>
        </div>
        
        <div class="service-meta">
            <span class="duration">‚è±Ô∏è {{ service.duration }} –º–∏–Ω</span>
            <span class="price">üí∞ {{ service.price|floatformat:0 }} ‚ÇΩ</span>
        </div>
        
        <p class="service-description">{{ service.description|truncatechars:150 }}</p>
        
        <div class="service-actions">
            <a href="{% url 'booking' %}?service={{ service.id }}" class="btn">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</a>
            {% if user.is_staff %}
                <a href="{% url 'admin:myapp_services_change' service.id %}" class="btn-outline">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
            {% endif %}
        </div>
    </div>
    {% empty %}
    <div class="no-services">
        <h3>–£—Å–ª—É–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ –ø–æ–∏—Å–∫</p>
    </div>
    {% endfor %}
</div>

<!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
{% if page_obj.has_other_pages %}
<nav class="pagination">
    {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}" class="pagination-link">‚Üê –ù–∞–∑–∞–¥</a>
    {% endif %}

    {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
            <span class="current-page">{{ num }}</span>
        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
            <a href="?page={{ num }}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}" class="pagination-link">{{ num }}</a>
        {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}" class="pagination-link">–í–ø–µ—Ä–µ–¥ ‚Üí</a>
    {% endif %}
</nav>
{% endif %}

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<section class="services-stats">
    <div class="stats-cards">
        <div class="stat-card">
            <strong>{{ page_obj.paginator.count }}</strong>
            <span>–í—Å–µ–≥–æ —É—Å–ª—É–≥</span>
        </div>
        <div class="stat-card">
            <strong>{{ categories|length }}</strong>
            <span>–ö–∞—Ç–µ–≥–æ—Ä–∏–π</span>
        </div>
        <div class="stat-card">
            <strong>{{ page_obj.paginator.num_pages }}</strong>
            <span>–°—Ç—Ä–∞–Ω–∏—Ü</span>
        </div>
    </div>
</section>
{% endblock %}