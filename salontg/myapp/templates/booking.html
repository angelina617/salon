{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title|default:"–û–Ω–ª–∞–π–Ω –∑–∞–ø–∏—Å—å - –°–∞–ª–æ–Ω –∫—Ä–∞—Å–æ—Ç—ã TanGel" }}{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'booking.css' %}">
{% endblock %}

{% block content %}
<div class="booking-hero">
    <h1>{{ hero_title|default:"–û–Ω–ª–∞–π–Ω –∑–∞–ø–∏—Å—å" }}</h1>
    <p>{{ hero_subtitle|default:"–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –∏ –º—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏" }}</p>
    <div class="booking-benefits">
        <span>–ë—ã—Å—Ç—Ä–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</span>
        <span>–£–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è</span>
        <span>{{ discount_text|default:"–°–∫–∏–¥–∫–∞ 10% –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–ø–∏—Å–∏" }}</span>
    </div>
</div>

<h2>{{ form_title|default:"–§–æ—Ä–º–∞ –∑–∞–ø–∏—Å–∏ –Ω–∞ –ø—Ä–∏–µ–º" }}</h2>
<p>{{ form_subtitle|default:"–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è ‚Äî –º—ã –ø–µ—Ä–µ–∑–≤–æ–Ω–∏–º –≤–∞–º –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç" }}</p>

<form method="post" id="booking-form">
    {% csrf_token %}
    
    <!-- –í—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± —É—Å–ø–µ—Ö–µ –∏–ª–∏ –æ—à–∏–±–∫–µ -->
    {% if messages %}
        <div class="messages-container">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}
    
    {% if error %}
        <div class="alert alert-danger">
            {{ error }}
        </div>
    {% endif %}
    
    {% if success_message %}
        <div class="alert alert-success">
            {{ success_message }}
        </div>
    {% endif %}

    <!-- –®–∞–≥ 1: –£—Å–ª—É–≥–∞ -->
    <section class="booking-step">
        <h3>1. –í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É</h3>

        <div class="services-list">
            {% for service in services %}
            <a href="?service_id={{ service.id }}" class="service-option {% if selected_service and selected_service.id == service.id %}selected{% endif %}">
                <h4>{{ service.name }}</h4>
                <div class="service-meta">
                    <span>‚è±Ô∏è {{ service.duration }} –º–∏–Ω</span>
                    <span>üí∞ {{ service.price|floatformat:0 }} ‚ÇΩ</span>
                </div>
            </a>
            {% empty %}
            <p>–£—Å–ª—É–≥–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</p>
            {% endfor %}
        </div>

        {% if selected_service %}
        <p><strong>–í—ã–±—Ä–∞–Ω–æ:</strong> <span id="selected-service">{{ selected_service.name }}</span></p>
        {% else %}
        <p><strong>–í—ã–±—Ä–∞–Ω–æ:</strong> <span id="selected-service">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</span></p>
        {% endif %}
    </section>

    <!-- –®–∞–≥ 2: –ú–∞—Å—Ç–µ—Ä -->
    <section class="booking-step">
        <h3>2. –í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Å—Ç–µ—Ä–∞</h3>

        {% if selected_service %}
            <label class="master-option">
                <input type="radio" name="master" value="auto" checked>
                <div class="master-info">
                    <strong>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥–±–æ—Ä</strong>
                    <p>–ú—ã –ø–æ–¥–±–µ—Ä—ë–º —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞ —Å –Ω—É–∂–Ω–æ–π —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π</p>
                </div>
            </label>

            {% for master in masters %}
            <label class="master-option">
                <input type="radio" name="master" value="{{ master.id }}">
                <div class="master-info">
                    <strong>{{ master.user.first_name }} {{ master.user.last_name }}</strong>
                    <p>{{ master.specialization }} ¬∑ {{ master.experience }} –ª–µ—Ç –æ–ø—ã—Ç–∞</p>
                    {% if master.photo %}
                        <img src="{{ master.photo.url }}" alt="–§–æ—Ç–æ –º–∞—Å—Ç–µ—Ä–∞" class="master-photo">
                    {% endif %}
                </div>
            </label>
            {% empty %}
            <p class="info-message">–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–µ—Ç –º–∞—Å—Ç–µ—Ä–æ–≤, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏—Ö —ç—Ç—É —É—Å–ª—É–≥—É. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥—É—é —É—Å–ª—É–≥—É.</p>
            {% endfor %}
    
            <p><strong>–í—ã–±—Ä–∞–Ω –º–∞—Å—Ç–µ—Ä:</strong> <span id="selected-master">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥–±–æ—Ä</span></p>
        {% else %}
            <p class="info-message">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–∞—Å—Ç–µ—Ä–æ–≤</p>
        {% endif %}
    </section>

    <!-- –®–∞–≥ 3: –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è -->
    <section class="booking-step">
        <h3>3. –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è</h3>
    
        <label>
            –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É:
            <input type="date" name="date" min="{{ today }}" required>
        </label>
    
        <label>
            –í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è:
            <select name="time" class="form-control" required>
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è</option>
                {% for hour in working_hours %}
                    <option value="{{ hour }}">{{ hour }}</option>
                {% endfor %}
            </select>
        </label>
    
        <p class="info-message">–†–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è —Å–∞–ª–æ–Ω–∞: 8:00 - 20:00</p>
    
        {% if busy_times %}
            <p class="warning">–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–Ω—è—Ç—ã</p>
        {% endif %}
    
        <p><strong>–í—ã–±—Ä–∞–Ω–æ –≤—Ä–µ–º—è:</strong> <span id="selected-time">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</span></p>
    </section>

    <!-- –®–∞–≥ 4: –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
    <section class="booking-step">
        <h3>4. –í–∞—à–∏ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
        
        <label>
            –ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è *
            <input type="text" name="client_name" required>
        </label>
        
        <label>
            –¢–µ–ª–µ—Ñ–æ–Ω *
            <input type="tel" name="client_phone" required>
        </label>
        
        <label>
            Email *
            <input type="email" name="client_email" required>
        </label>
        
        <label>
            –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–ø–∏—Å–∏
            <textarea name="notes"></textarea>
        </label>
    </section>

    <!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –¥–ª—è —É—Å–ª—É–≥–∏ –∏ –º–∞—Å—Ç–µ—Ä–∞ -->
    {% if selected_service %}
    <input type="hidden" name="service" value="{{ selected_service.id }}">
    {% endif %}

    <!-- –°–æ–≥–ª–∞—Å–∏—è -->
    <div class="consent-section">
        <label>
            <input type="checkbox" required>
            –Ø —Å–æ–≥–ª–∞—à–∞—é—Å—å —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∑–∞–ø–∏—Å–∏
            –∏ –¥–∞—é —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö *
        </label>
    </div>

    <div class="form-actions">
        <button type="submit" class="btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –∑–∞–ø–∏—Å—å</button>
    </div>
</form>

<p class="booking-note">
    –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã –º—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏.
</p>

<!-- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ -->
<h2>{{ benefits_title|default:"–ü–æ—á–µ–º—É —Å—Ç–æ–∏—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –æ–Ω–ª–∞–π–Ω?" }}</h2>
<div class="benefits-grid">
    <div class="benefit-card">
        <h4>–ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–∞—è –∑–∞–ø–∏—Å—å</h4>
        <p>–ó–∞–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è, –¥–∞–∂–µ –Ω–æ—á—å—é</p>
    </div>
    <div class="benefit-card">
        <h4>–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏</h4>
        <p>–í–∞—à–µ –≤—Ä–µ–º—è –±—É–¥–µ—Ç –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–æ –∑–∞ –≤–∞–º–∏</p>
    </div>
    <div class="benefit-card">
        <h4>–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</h4>
        <p>–°–ú–° –∏ email-–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –≤–∏–∑–∏—Ç–µ</p>
    </div>
</div>

<!-- –°—Ç–∏–ª–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π -->
<style>
    .messages-container {
        margin-bottom: 20px;
    }

    .alert {
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 15px;
        border: 1px solid transparent;
        font-size: 16px;
    }

    .alert-success {
        background-color: #d4edda;
        color: #155724;
        border-color: #c3e6cb;
    }

    .alert-danger {
        background-color: #f8d7da;
        color: #721c24;
        border-color: #f5c6cb;
    }

    .alert-info {
        background-color: #d1ecf1;
        color: #0c5460;
        border-color: #bee5eb;
    }
</style>
{% endblock %}