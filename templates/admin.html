{% extends 'base.html' %}
{% load static humanize %}

{% block title %}{{ page_title|default:"–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Äî TanGel" }}{% endblock %}

{% block content %}
<div class="admin-dashboard">
    <header class="dashboard-header">
        <h1>{{ dashboard_title|default:"–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∞–ª–æ–Ω–æ–º" }}</h1>
        <div class="dashboard-stats">
            <div>üìÖ {{ today_bookings_count|default:0 }} –∑–∞–ø–∏—Å–µ–π —Å–µ–≥–æ–¥–Ω—è</div>
            <div>üë• {{ current_clients_count|default:0 }} –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ —Å–∞–ª–æ–Ω–µ</div>
            <div>‚ÇΩ {{ today_revenue|default:0|intcomma }} –≤—ã—Ä—É—á–∫–∞</div>
            <div>üïó {{ current_time|time:"H:i" }}</div>
        </div>
        <div class="user-info">
            {% if user.profile.avatar %}
                <img src="{{ user.profile.avatar.url }}" alt="–ê–≤–∞—Ç–∞—Ä" class="avatar">
            {% else %}
                <div class="avatar-placeholder">üë§</div>
            {% endif %}
            <div>
                <strong>{{ user.get_full_name|default:user.username }}</strong><br>
                {% if user.is_superuser %}
                    <span class="role">–°—É–ø–µ—Ä–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                {% elif user.is_staff %}
                    <span class="role">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                {% endif %}<br>
                –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥: {{ user.last_login|date:"d.m.Y H:i"|default:"–ù–µ–¥–∞–≤–Ω–æ" }}
            </div>
        </div>
    </header>

    <aside class="admin-sidebar">
        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
        <ul>
            <li><a href="#dashboard">–î–∞—à–±–æ—Ä–¥</a></li>
            <li><a href="#bookings">–ó–∞–ø–∏—Å–∏ <span class="badge">{{ pending_bookings_count|default:0 }}</span></a></li>
            <li><a href="#clients">–ö–ª–∏–µ–Ω—Ç—ã <span class="badge">{{ total_clients_count|default:0 }}</span></a></li>
            <li><a href="#masters">–ú–∞—Å—Ç–µ—Ä–∞ <span class="badge">{{ active_masters_count|default:0 }}</span></a></li>
            <li><a href="#schedule">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</a></li>
        </ul>

        <h3>–§–∏–Ω–∞–Ω—Å—ã</h3>
        <ul>
            <li><a href="#analytics">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a></li>
            <li><a href="#payments">–ü–ª–∞—Ç–µ–∂–∏</a></li>
            <li><a href="#reports">–û—Ç—á—ë—Ç—ã</a></li>
            <li><a href="#expenses">–†–∞—Å—Ö–æ–¥—ã</a></li>
        </ul>

        <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
        <ul>
            <li><a href="#services">–£—Å–ª—É–≥–∏</a></li>
            <li><a href="#promotions">–ê–∫—Ü–∏–∏ <span class="badge">{{ active_promotions_count|default:0 }}</span></a></li>
            <li><a href="#employees">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</a></li>
            <li><a href="#settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∞–ª–æ–Ω–∞</a></li>
        </ul>

        <div class="quick-actions">
            <button class="btn">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
            <button class="btn">–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</button>
            <button class="btn">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥</button>
        </div>
    </aside>

    <main class="admin-content">
        <section id="dashboard">
            <h2>–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            <div class="period-selector">
                <button>–°–µ–≥–æ–¥–Ω—è</button>
                <button>–≠—Ç–∞ –Ω–µ–¥–µ–ª—è</button>
                <button>–≠—Ç–æ—Ç –º–µ—Å—è—Ü</button>
                <button>–≠—Ç–æ—Ç –≥–æ–¥</button>
                <button>–í—ã–±—Ä–∞—Ç—å –ø–µ—Ä–∏–æ–¥</button>
                <button>–û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>
            {% include 'admin/includes/stats_cards.html' %}

            <h3>–í—ã—Ä—É—á–∫–∞ –ø–æ –¥–Ω—è–º</h3>
            <div class="chart-period-toggle">
                <button>–¢–µ–∫—É—â–∏–π –ø–µ—Ä–∏–æ–¥</button>
                <button>–ü—Ä–æ—à–ª—ã–π –ø–µ—Ä–∏–æ–¥</button>
            </div>

            <h3>–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</h3>
            <div class="chart-type-toggle">
                <button>–ü–æ –¥–Ω—è–º</button>
                <button>–ü–æ –Ω–µ–¥–µ–ª—è–º</button>
                <button>–ü–æ –º–µ—Å—è—Ü–∞–º</button>
            </div>

            <h3>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —É—Å–ª—É–≥–∏</h3>
            {% for service in popular_services %}
            <div class="service-item">
                <strong>{{ service.name }}</strong>
                <span>{{ service.booking_count }} ({{ service.revenue|floatformat:0|intcomma }} ‚ÇΩ)</span>
            </div>
            {% empty %}
            <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —É—Å–ª—É–≥–∞—Ö</p>
            {% endfor %}

            <h3>–¢–æ–ø –º–∞—Å—Ç–µ—Ä–∞</h3>
            {% for master in top_masters %}
            <div class="master-card">
                {% if master.photo %}
                    <img src="{{ master.photo.url }}" alt="{{ master.name }}">
                {% else %}
                    <div class="avatar-placeholder">üë§</div>
                {% endif %}
                <div>
                    <h4>{{ master.name }}</h4>
                    <p>{{ master.specialization }}</p>
                    <p>{{ master.booking_count }} –∑–∞–ø–∏—Å–µ–π | {{ master.revenue|floatformat:0|intcomma }} ‚ÇΩ | {{ master.rating|floatformat:1 }}/5</p>
                </div>
            </div>
            {% empty %}
            <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –º–∞—Å—Ç–µ—Ä–∞—Ö</p>
            {% endfor %}

            <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏</h3>
            <a href="#bookings">–í—Å–µ –∑–∞–ø–∏—Å–∏ ‚Üí</a>
            {% for booking in recent_bookings %}
            <div class="booking-row">
                <div>{{ booking.datetime|date:"H:i" }}</div>
                <div>{{ booking.datetime|date:"d.m.Y" }}</div>
                <div>{{ booking.client.get_full_name|default:booking.client.username }}</div>
                <div>{{ booking.service.name }}</div>
                <div>{{ booking.master.name|default:"–õ—é–±–æ–π" }}</div>
                <div class="status {{ booking.status }}">{{ booking.get_status_display }}</div>
                {% if booking.status == 'pending' %}
                    <button>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                {% endif %}
            </div>
            {% empty %}
            <p>–ù–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π</p>
            {% endfor %}
        </section>

        <!-- –î—Ä—É–≥–∏–µ —Å–µ–∫—Ü–∏–∏ –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ -->
    </main>
</div>
{% endblock %}